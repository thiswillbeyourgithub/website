{% include base_path %}

{% assign page_lang = page.lang | default: site.locale | default: 'en' %}
{% case site.categories.type %}
  {% when "liquid" %}
    {% assign path_type = "#" %}
  {% when "jekyll-archives" %}
    {% assign path_type = nil %}
{% endcase %}

{% if page.collection != 'posts' %}
  {% assign path_type = nil %}
  {% assign crumb_path = '/' %}
{% else %}
  {% assign crumb_path = site.categories.path %}
{% endif %}

<nav class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList">

    {% assign crumbs = page.url | split: '/' %}
    {% assign i = 1 %}
    {% assign accumulated_path = "" %}
    {% for crumb in crumbs offset: 1 %}
      {% if crumb != "" %}
        {% if forloop.first %}

          <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="{{ base_path }}/" itemprop="item"><span itemprop="name">{{ site.data.ui-text[page_lang].breadcrumb_home_label | default: "Home" }}</span></a>
            <meta itemprop="position" content="{{ i }}" />
          </li>
          <span class="sep"> {{ site.data.ui-text[page_lang].breadcrumb_separator | default: "/" }} </span>
        {% endif %}
        {% if forloop.last %}
          <li class="current">{{ page.title }}</li>

          {% if site.repository != "" and site.repository != nil %}
              <li>
                  <a href="https://github.com/{{ site.repository }}/blob/{{ site.branch }}/{{ page.path }}" class="page-source-link">
                      <i class="fa fa-code" aria-hidden="true"></i>{{ site.data.ui-text[page_lang].view_page_source | default: "View page source" }}
                  </a>
              </li>
          {% endif %}
        {% else %}
          {% assign i = i | plus: 1 %}
          {% assign accumulated_path = accumulated_path | append: "/" | append: crumb %}
          <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="{{ base_path }}{{ accumulated_path }}/" itemprop="item"><span itemprop="name">{{ crumb | replace: '-', ' ' | replace: '%20', ' ' | capitalize }}</span></a>
            <meta itemprop="position" content="{{ i }}" />
          </li>
          <span class="sep"> {{ site.data.ui-text[page_lang].breadcrumb_separator | default: "/" }} </span>
        {% endif %}
      {% endif %}
    {% endfor %}
  </ol>
  
</nav>
